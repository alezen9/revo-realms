import{L as Gt,T as Ht,D as Wt,G as zt,C as Vt,S as Ce,P as Zt,p as jt,m as qt,o as Yt,e as Kt,s as Jt,W as Xt,a as $t,A as Qt,b as es,c as ts,d as ss,f as os,g as as,h as ns,V as E,M as Ne,H as is,i as rs,O as ls,F as b,t as S,v as L,j as cs,k as me,I as oe,l as et,n as se,q as N,r as y,u as I,w as D,x as G,y as p,z as qe,B,E as Y,J as tt,K as V,N as st,Q as ds,R as us,U as ms,X as hs,Y as C,Z as g,_ as ae,$ as ps,a0 as W,a1 as Q,a2 as Ye,a3 as fs,a4 as h,a5 as Re,a6 as k,a7 as Se,a8 as ot,a9 as le,aa as O,ab as fe,ac as ye,ad as be,ae as ys,af as gs,ag as ws,ah as bs,ai as at,aj as As,ak as xs,al as De,am as nt,an as Ss,ao as Be,ap as it,aq as _s,ar as ge,as as Ae,at as Ls,au as Ms,av as xe,aw as rt,ax as Ke,ay as Is,az as Ps,aA as vs,aB as Es}from"./three-ByJBfi5R.js";import{P as Ts}from"./tweakpane-BXg6ZhiP.js";import{S as Je}from"./stats-gl-C2M3amu4.js";import{e as Ds}from"./tseep-DsfRTLTM.js";import{World as Cs,EventQueue as Ns,RigidBodyDesc as K,ColliderDesc as J,HeightFieldFlags as Bs,Ray as Rs,ActiveEvents as Fs,__tla as __tla_0}from"./@dimforge-Tx9Ov1ko.js";import{n as Os}from"./nipplejs-BxsX8Mt3.js";Promise.all([(()=>{try{return __tla_0}catch{}})()]).then(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const Us="/revo-realms/models/realm.glb",ks="/revo-realms/textures/environment/px.webp",Gs="/revo-realms/textures/environment/nx.webp",Hs="/revo-realms/textures/environment/py.webp",Ws="/revo-realms/textures/environment/ny.webp",zs="/revo-realms/textures/environment/pz.webp",Vs="/revo-realms/textures/environment/nz.webp",Zs="/revo-realms/textures/noise/noise.webp",js="/revo-realms/textures/realm/terrainType.webp",qs="/revo-realms/textures/realm/sandNormal.webp",Ys="/revo-realms/textures/realm/grassNormal.webp",Ks="/revo-realms/textures/realm/grassDiffuse.webp",Js="/revo-realms/textures/realm/waterNormal.webp",Xs="/revo-realms/textures/realm/terrainShadowAo.webp",$s="/revo-realms/textures/realm/waterLiliesDiffuse.webp",Qs="/revo-realms/textures/realm/waterLiliesAlpha.webp",eo="/revo-realms/textures/realm/flowerAtlas.webp",to="/revo-realms/textures/realm/stoneAtlas.webp",so="/revo-realms/textures/realm/barkDiffuse.webp",oo="/revo-realms/textures/realm/barkNormal.webp",ao="/revo-realms/textures/realm/canopyDiffuse.webp",no="/revo-realms/textures/realm/canopyNormal.webp",io="/revo-realms/textures/realm/axeDiffuse.webp",ro="/revo-realms/textures/realm/axeEmissive.webp",lo="/revo-realms/textures/realm/trunkDiffuse.webp",co="/revo-realms/textures/realm/trunkNormal.webp",uo="/revo-realms/textures/realm/onePieceAtlas.webp",mo="/revo-realms/textures/realm/kunaiDiffuse.webp",ho="/revo-realms/textures/realm/kunaiMR.webp",po="/revo-realms/textures/realm/campfireDiffuse.webp",fo="/revo-realms/textures/realm/fireSprites.webp",yo={stoneDiffuse:{scale:[.4921875,.4921875],offset:[.00390625,.00390625]},stoneMossyDiffuse:{scale:[.4921875,.4921875],offset:[.00390625,.50390625]},stoneMossyNormalAo:{scale:[.4921875,.4921875],offset:[.50390625,.00390625]},stoneNormalAo:{scale:[.4921875,.4921875],offset:[.50390625,.50390625]}},go={stones:yo};class wo{manager;constructor(){this.manager=this.createLoadingManager()}onErrorLog(e){console.log("There was an error loading "+e)}createLoadingManager(){const e=new Gt;return e.onError=this.onErrorLog,e}}const lt=new wo;class bo{atlasesCoords=go;textureLoader;gltfLoader;cubeTextureLoader;realmModel;noiseTexture;envMapTexture;terrainTypeMap;terrainShadowAo;grassDiffuse;sandNormal;grassNormal;waterNormal;waterLiliesTexture;waterLiliesAlphaTexture;flowerAtlas;stoneAtlas;canopyDiffuse;canopyNormal;barkDiffuse;barkNormal;axeDiffuse;axeEmissive;trunkDiffuse;trunkNormal;onePieceAtlas;kunaiDiffuse;kunaiMR;campfireDiffuse;fireSprites;constructor(e){this.textureLoader=new Ht(e);const t=new Wt;t.setDecoderPath("/revo-realms/draco/"),this.gltfLoader=new zt(e),this.gltfLoader.setDRACOLoader(t),this.cubeTextureLoader=new Vt(e)}async initAsync(){const e=await Promise.all([this.gltfLoader.loadAsync(Us),c.cubeTextureLoader.loadAsync([ks,Gs,Hs,Ws,zs,Vs]),this.textureLoader.loadAsync(Zs),this.textureLoader.loadAsync(js),this.textureLoader.loadAsync(Ks),this.textureLoader.loadAsync(Ys),this.textureLoader.loadAsync(qs),this.textureLoader.loadAsync(Js),this.textureLoader.loadAsync(Xs),this.textureLoader.loadAsync($s),this.textureLoader.loadAsync(Qs),this.textureLoader.loadAsync(eo),this.textureLoader.loadAsync(to),this.textureLoader.loadAsync(ao),this.textureLoader.loadAsync(no),this.textureLoader.loadAsync(so),this.textureLoader.loadAsync(oo),this.textureLoader.loadAsync(io),this.textureLoader.loadAsync(ro),this.textureLoader.loadAsync(lo),this.textureLoader.loadAsync(co),this.textureLoader.loadAsync(uo),this.textureLoader.loadAsync(mo),this.textureLoader.loadAsync(ho),this.textureLoader.loadAsync(po),this.textureLoader.loadAsync(fo)]);this.realmModel=e[0],this.envMapTexture=e[1],this.envMapTexture.generateMipmaps=!1,this.noiseTexture=e[2],this.terrainTypeMap=e[3],this.terrainTypeMap.flipY=!1,this.grassDiffuse=e[4],this.grassNormal=e[5],this.sandNormal=e[6],this.waterNormal=e[7],this.terrainShadowAo=e[8],this.terrainShadowAo.flipY=!1,this.waterLiliesTexture=e[9],this.waterLiliesTexture.flipY=!1,this.waterLiliesAlphaTexture=e[10],this.waterLiliesAlphaTexture.flipY=!1,this.flowerAtlas=e[11],this.flowerAtlas.flipY=!1,this.stoneAtlas=e[12],this.stoneAtlas.flipY=!1,this.canopyDiffuse=e[13],this.canopyDiffuse.flipY=!1,this.canopyNormal=e[14],this.canopyNormal.flipY=!1,this.barkDiffuse=e[15],this.barkDiffuse.flipY=!1,this.barkNormal=e[16],this.barkNormal.flipY=!1,this.axeDiffuse=e[17],this.axeDiffuse.flipY=!1,this.axeEmissive=e[18],this.axeEmissive.flipY=!1,this.trunkDiffuse=e[19],this.trunkDiffuse.flipY=!1,this.trunkNormal=e[20],this.trunkNormal.flipY=!1,this.onePieceAtlas=e[21],this.onePieceAtlas.flipY=!1,this.kunaiDiffuse=e[22],this.kunaiDiffuse.flipY=!1,this.kunaiDiffuse.colorSpace=Ce,this.kunaiMR=e[23],this.kunaiMR.flipY=!1,this.campfireDiffuse=e[24],this.campfireDiffuse.flipY=!1,this.campfireDiffuse.colorSpace=Ce,this.fireSprites=e[25]}}const c=new bo(lt.manager);class Ao{panel;constructor(){this.panel=new Ts({title:"Revo Realms"}),this.panel.hidden=!0,this.panel.element.parentElement?.classList.add("debug-panel")}setVisibility(e){this.panel.hidden=!e}}const te=new Ao;class xo{stats;lastSecond=performance.now();drawCallsPanel;trianglesPanel;constructor(e){const t=new Je({trackGPU:!0,logsPerSecond:4,graphsPerSecond:30,samplesLog:40,samplesGraph:10,horizontal:!1,precision:2});t.dom.classList.add("monitoring-panel"),e&&document.body.appendChild(t.dom),this.stats=t,this.drawCallsPanel=this.createNumberPanel("# DRAW CALLS","#fff","#333"),this.trianglesPanel=this.createNumberPanel("# TRIANGLES","#ffdab9","#163843")}createNumberPanel(e,t,s){const o=this.stats.addPanel(new Je.Panel(e,t,s));return o.update=a=>{const n=o.canvas.getContext("2d");if(!n)return;const{width:i,height:r}=o.canvas;n.clearRect(0,0,i,r),n.fillStyle=s,n.fillRect(0,0,i,r),n.fillStyle=t;const d=n.font;n.textAlign="left",n.textBaseline="top",n.fillText(o.name,4,4),n.font="bold 20px Arial",n.textAlign="center",n.textBaseline="middle";const u=So.format(a);n.fillText(`${u}`,i/2,r/1.65),n.font=d},o}updateCustomPanels(){const e=performance.now();if(e-this.lastSecond<1e3)return;const{render:t}=q.renderer.info;this.drawCallsPanel.update(t.drawCalls,0),this.trianglesPanel.update(t.triangles,0),this.lastSecond=e}}const So=new Intl.NumberFormat("en-US",{notation:"compact"}),_o=[16,64],R=new Ds.EventEmitter,Lo=l=>{let e=0;R.on("update",t=>{e++,!(e<l)&&(e=0,R.emit(`update-throttle-${l}x`,t))})};_o.forEach(l=>Lo(l));class Mo extends Zt{scenePass;constructor(e){super(e),this.scenePass=jt(A.scene,A.renderCamera),this.scenePass.setMRT(qt({output:Yt,emissive:Kt}));const t=this.getPasses();this.outputNode=t,R.on("camera-changed",()=>{this.scenePass.camera=A.renderCamera,this.scenePass.needsUpdate=!0})}getPasses(){return Jt(this.scenePass)}}class Io{renderer;canvas;monitoringManager;postprocessingManager;IS_POSTPROCESSING_ENABLED=!0;IS_MONITORING_ENABLED=!1;IS_DEBUGGING_ENABLED=!1;constructor(){const e=document.createElement("canvas");e.classList.add("revo-realms"),document.body.appendChild(e),this.canvas=e;const t=new Xt({canvas:e,antialias:!0,trackTimestamp:this.IS_MONITORING_ENABLED,powerPreference:"high-performance",stencil:!1,depth:!0});t.shadowMap.enabled=!0,t.shadowMap.type=$t,t.toneMapping=Qt,t.outputColorSpace=Ce,t.setClearColor(0,1),t.toneMappingExposure=1.5,this.renderer=t,this.monitoringManager=new xo(this.IS_MONITORING_ENABLED),te.setVisibility(this.IS_DEBUGGING_ENABLED)}async init(){this.postprocessingManager=new Mo(this.renderer),this.IS_MONITORING_ENABLED&&await this.monitoringManager.stats.init(this.renderer)}async renderSceneAsync(){return this.IS_POSTPROCESSING_ENABLED?this.postprocessingManager.renderAsync():this.renderer.renderAsync(A.scene,A.renderCamera)}async renderWithMonitoring(){await this.renderer.resolveTimestampsAsync("compute"),await this.renderSceneAsync(),this.monitoringManager.updateCustomPanels(),await this.renderer.resolveTimestampsAsync("render"),this.monitoringManager.stats.update()}async renderAsync(){this.IS_MONITORING_ENABLED?this.renderWithMonitoring():this.renderSceneAsync()}}const q=new Io;class Po{scene;playerCamera;renderCamera;cameraHelper;controls;orbitControlsCamera;constructor(){const e=new es;this.scene=e;const t=window.innerWidth,s=window.innerHeight,o=t/s,a=new ts(45,o,.01,150);a.position.set(0,5,10),this.playerCamera=a,e.add(a),this.renderCamera=a}debugScene(){if(!this.controls)return;te.panel.addFolder({title:"\uD83C\uDFA5 View"}).addBinding(this.controls,"enabled",{label:"Enable orbit controls"}).on("change",({value:t})=>{!this.cameraHelper||!this.orbitControlsCamera||(this.renderCamera=t?this.orbitControlsCamera:this.playerCamera,this.cameraHelper.visible=t,R.emit("camera-changed"))})}update(){this.controls?.enabled&&this.controls.update()}}const A=new Po,vo="/revo-realms/audio/ambient/ambient.mp3",Eo="/revo-realms/audio/ambient/lake.mp3",To="/revo-realms/audio/collisions/hitWood.mp3",Do="/revo-realms/audio/collisions/hitStone.mp3";class Co{audioLoader;audioListener;isReady=!1;isMute=!0;files=[];ambient;lake;hitWood;hitStone;constructor(e){this.audioLoader=new ss(e),this.audioListener=new os,A.playerCamera.add(this.audioListener)}async toggleMute(){if(!this.isReady)return;const e=this.audioListener.context;e.state==="suspended"&&await e.resume(),this.isMute=!this.isMute,this.files.forEach(t=>{const s=this.isMute?0:t.userData.originalVolume;t.setVolume(s),t.loop&&!t.isPlaying&&t.play()})}newAudio(e,t=1,s=!1){const o=new as(this.audioListener);return o.setBuffer(e),o.setVolume(0),o.setLoop(s),o.userData.originalVolume=t,this.files.push(o),o}newPositionalAudio(e,t=1,s=!1,o=1){const a=new ns(this.audioListener);return a.setBuffer(e),a.setVolume(0),a.setLoop(s),a.userData.originalVolume=t,a.setMaxDistance(o),this.files.push(a),a}async initAsync(){const e=await Promise.all([this.audioLoader.loadAsync(vo),this.audioLoader.loadAsync(Eo),this.audioLoader.loadAsync(To),this.audioLoader.loadAsync(Do)]);this.ambient=this.newAudio(e[0],.01,!0),this.lake=this.newPositionalAudio(e[1],1,!0,10),this.hitWood=this.newAudio(e[2],0,!1),this.hitStone=this.newAudio(e[3],0,!1),this.isReady=!0,R.emit("audio-ready")}}const j=new Co(lt.manager),No="modulepreload",Bo=function(l){return"/revo-realms/"+l},Xe={},Ro=function(e,t,s){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),i=n?.nonce||n?.getAttribute("nonce");o=Promise.allSettled(t.map(r=>{if(r=Bo(r),r in Xe)return;Xe[r]=!0;const d=r.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${u}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":No,d||(m.as="script"),m.crossOrigin="",m.href=r,i&&m.setAttribute("nonce",i),document.head.appendChild(m),d)return new Promise((w,f)=>{m.addEventListener("load",w),m.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})}))}function a(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return o.then(n=>{for(const i of n||[])i.status==="rejected"&&a(i.reason);return e().catch(a)})};var U=(l=>(l.Player="Player",l.Terrain="Terrain",l.Wood="Wood",l.Stone="Stone",l))(U||{});const Fo=()=>({minImpactSq:5,maxImpactSq:400,minImpactVolume:.01,maxImpactVolume:.08}),ee=Fo();class Oo{world;eventQueue;dummyVectorLinVel=new E;constructor(){}async initAsync(){return Ro(()=>import("./@dimforge-Tx9Ov1ko.js").then(async m=>{await m.__tla;return m}),[]).then(()=>{this.world=new Cs({x:0,y:-9.81,z:0}),this.eventQueue=new Ns(!0)})}getColliderName(e){return e?.parent?.()?.userData?.type}impactToVolume(e){const t=Ne.mapLinear(e,ee.minImpactSq,ee.maxImpactSq,ee.minImpactVolume,ee.maxImpactVolume);return Ne.clamp(t,ee.minImpactVolume,ee.maxImpactVolume)}onCollisionWithWood(e){const t=e.parent()?.linvel();if(!t)return;this.dummyVectorLinVel.copy(t);const s=this.dummyVectorLinVel.lengthSq();if(s<ee.minImpactSq)return;const o=this.impactToVolume(s);j.hitWood.setVolume(o),j.hitWood.play()}onCollisionWithStone(e){const t=e.parent()?.linvel();if(!t)return;this.dummyVectorLinVel.copy(t);const s=this.dummyVectorLinVel.lengthSq();if(s<ee.minImpactSq)return;const o=this.impactToVolume(s);j.hitStone.setVolume(o),j.hitStone.play()}handleCollisionSounds(){this.eventQueue.drainCollisionEvents((e,t,s)=>{if(j.isMute)return;const o=this.world.getCollider(e),a=this.world.getCollider(t);if(!(this.getColliderName(o)===U.Player)||!s)return;switch(this.getColliderName(a)){case U.Wood:this.onCollisionWithWood(o);break;case U.Stone:this.onCollisionWithStone(o);break}})}update(){this.world.step(this.eventQueue),j.isReady&&this.handleCollisionSounds()}}const v=new Oo;class Uo{constructor(){("ontouchstart"in window||navigator.maxTouchPoints>0)&&document.body.classList.add("is-touch-device")}async initAsync(){j.initAsync(),await Promise.all([v.initAsync(),c.initAsync()])}}class ko{keysPressed;keyDownListeners;keyUpListeners;constructor(){this.keysPressed=new Set,this.keyDownListeners=new Map,this.keyUpListeners=new Map,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}handleKeyDown(e){const t=e.code;this.keysPressed.has(t)||(this.keysPressed.add(t),this.keyDownListeners.get(t)?.())}handleKeyUp(e){const t=e.code;this.keysPressed.delete(t),this.keyUpListeners.get(t)?.()}isKeyPressed(e){return e==="*"?this.keysPressed.size>0:this.keysPressed.has(e)}onKeyDown(e,t){this.keyDownListeners.set(e,t)}onKeyUp(e,t){this.keyUpListeners.set(e,t)}dispose(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)}}const $=new ko;class Go{isActive=!1;direction={x:0,y:0};constructor(){const e=document.createElement("div");e.classList.add("joystick-zone"),document.body.appendChild(e);const t=Os.create({zone:e,mode:"static",position:{left:"50%",top:"50%"},restOpacity:.1,size:100,threshold:.2});t.on("start",()=>{this.isActive=!0}),t.on("move",(s,o)=>{o?.vector&&(this.direction={x:o.vector.x,y:o.vector.y})}),t.on("end",()=>{this.isActive=!1,this.direction={x:0,y:0}})}threshold=.2;isForward(){return this.isActive&&this.direction.y>-this.threshold}isBackward(){return this.isActive&&this.direction.y<this.threshold}isLeftward(){return this.isActive&&this.direction.x<-this.threshold}isRightward(){return this.isActive&&this.direction.x>this.threshold}}const we=new Go;class Ho{isForward(){return $.isKeyPressed("KeyW")||$.isKeyPressed("ArrowUp")||we.isForward()}isBackward(){return $.isKeyPressed("KeyS")||$.isKeyPressed("ArrowDown")||we.isBackward()}isLeftward(){return $.isKeyPressed("KeyA")||$.isKeyPressed("ArrowLeft")||we.isLeftward()}isRightward(){return $.isKeyPressed("KeyD")||$.isKeyPressed("ArrowRight")||we.isRightward()}isJumpPressed(){return $.isKeyPressed("Space")}}const ue=new Ho,re={LIGHT_POSITION_OFFSET:new E(10,10,10)};class Wo{directionalLight;hemisphereLight;constructor(){this.directionalLight=this.setupDirectionalLighting(),A.scene.add(this.directionalLight),this.hemisphereLight=this.setupHemisphereLight(),A.scene.add(this.hemisphereLight),R.on("update",({player:e})=>{this.directionalLight.position.copy(e.position).add(re.LIGHT_POSITION_OFFSET)}),this.debugLight()}setupHemisphereLight(){const e=new is;return e.color.setRGB(.6,.4,.5),e.groundColor.setRGB(.3,.2,.2),e.intensity=.3,e.position.copy(re.LIGHT_POSITION_OFFSET),e}setupDirectionalLighting(){const e=new rs;e.intensity=.8,e.color.setRGB(.85,.75,.7),e.position.copy(re.LIGHT_POSITION_OFFSET),e.target=new ls,e.castShadow=!0,e.shadow.mapSize.set(64,64);const t=1;return e.shadow.intensity=.85,e.shadow.camera.left=-t,e.shadow.camera.right=t,e.shadow.camera.top=t,e.shadow.camera.bottom=-t,e.shadow.camera.near=.01,e.shadow.camera.far=30,e.shadow.normalBias=.1,e.shadow.bias=-.001,e}getTerrainShadowFactor=b(([e=L(0)])=>S(c.terrainShadowAo,e).r);debugLight(){const e=te.panel.addFolder({title:"\uD83D\uDCA1 Light"});e.expanded=!1,e.addBinding(re.LIGHT_POSITION_OFFSET,"x",{label:"Sun position X"}),e.addBinding(re.LIGHT_POSITION_OFFSET,"z",{label:"Sun position Z"}),e.addBinding(re.LIGHT_POSITION_OFFSET,"y",{label:"Sun height"}),e.addBinding(this.directionalLight,"color",{label:"Directional Color",view:"color",color:{type:"float"}}),e.addBinding(this.directionalLight,"intensity",{min:0,max:5,label:"Directional intensity"}),e.addBinding(this.hemisphereLight,"color",{label:"Hemisphere sky color",view:"color",color:{type:"float"}}),e.addBinding(this.hemisphereLight,"groundColor",{label:"Hemisphere ground color",view:"color",color:{type:"float"}}),e.addBinding(this.hemisphereLight,"intensity",{min:0,max:1,label:"Hemisphere intensity"})}setTarget(e){this.directionalLight.target=e}}const ct=new Wo,dt=new cs,$e=new me;R.on("update-throttle-16x",()=>{$e.multiplyMatrices(A.renderCamera.projectionMatrix,A.renderCamera.matrixWorldInverse),dt.setFromProjectionMatrix($e)});const ut=l=>(l.geometry.boundingSphere||l.geometry.computeBoundingSphere(),dt.intersectsObject(l)),zo=b(([l])=>{});class Vo extends oe{mainBuffer;constructor(e){let t,s,o=zo;switch(super(new et,void 0,e.count),this.mainBuffer=se(e.count,"vec4"),this.mainBuffer.setPBO(!0),e.preset){case"custom":t=e.material,s=e.onInit,o=e.onUpdate;break;case"fire":const i=Zo(e,this.mainBuffer);t=i.material,s=i.onInit,o=i.onUpdate;break;default:throw new Error("preset not provided for particle system")}this.material=t;const a=o(this.mainBuffer).compute(e.count),n=s?.(this.mainBuffer).compute(e.count);n&&a?.onInit(({renderer:i})=>{i.computeAsync(n)}),R.on("update",()=>{ut(this)&&q.renderer.computeAsync(a)})}}const Zo=(l,e)=>{const{speed:t=.5,radius:s=1,height:o=1,lifetime:a=1,scale:n=1,detail:i=4,coneFactor:r=1}=l,d=o*1.5,u=a*.75,m=se(l.count,"float"),w=.95,f=b(([ke])=>{const ve=N(y.add(12345)),ie=m.element(y),he=I(w,ve);ie.assign(he)}),_=b(([ke])=>{const ve=ke.element(y),ie=m.element(y),he=N(y),Ee=D(a,u,ie),pe=G.mul(t).add(he.mul(Ee)).mod(Ee).div(Ee),Te=p(1).sub(p(1).sub(pe).pow(2)),Ge=D(o,d,ie),He=Te.mul(Ge),We=N(y.add(7890)).mul(qe),Mt=N(y.add(5678)),It=p(1).sub(p(1).sub(Mt).pow(2)),Pt=p(1).sub(Te.mul(r)),vt=B(0,.35,Te),Et=Y(G.mul(.5)).mul(.05).add(1),Tt=D(s*.25,s,vt).mul(Pt).mul(Et),Dt=It.mul(Tt),Ct=I(.5,We).mul(2).sub(1),ze=We.add(pe.mul(qe).mul(.05).mul(Ct)),Nt=D(1,.85,ie),Ve=he.sub(.5).mul(.05).mul(pe),Bt=B(0,.75,pe).mul(ie),Ze=Dt.add(Bt.mul(Nt)),Rt=tt(ze.add(Ve)).mul(Ze),Ft=Y(ze.add(Ve)).mul(Ze),je=He.div(Ge),Ot=B(0,.5,je),Ut=p(1).sub(B(.5,1,je)),kt=Ot.mul(Ut);ve.assign(V(Rt,He,Ft,kt))}),x=new st;x.precision="lowp",x.transparent=!0,x.depthWrite=!1,x.blending=ds,x.blendEquation=us,x.blendSrc=ms,x.blendDst=hs;const z=e.element(y),F=m.element(y),ne=N(y.add(9234)),X=N(y.add(33.87));x.positionNode=z.xyz;const ce=p(1).sub(F.mul(.85)),_e=X.clamp(.25,1);x.scaleNode=_e.mul(z.w).mul(ce).mul(n);const Le=I(.5,ne).mul(.5),Me=I(.5,X).mul(.5),Ie=C().mul(.5).add(L(Le,Me)),de=S(c.fireSprites,Ie,i),ft=g(.72,.62,.08).mul(2).toConst(),Oe=g(1,.1,0).mul(4).toConst(),yt=g(0).toConst(),gt=D(o,d,F),Pe=B(0,1,ae.y.div(gt)).pow(2),wt=B(0,.25,Pe),bt=D(ft,Oe,wt),At=B(.9,1,Pe),xt=D(bt,yt,At),St=p(1).sub(B(0,.85,Pe)),_t=I(.65,X).mul(St),Ue=p(.5).toConst(),Lt=de.a.mul(_t).mul(Ue);return x.colorNode=D(xt,Oe,F).mul(Lt),x.opacityNode=z.w.mul(de.a).mul(Ue),{material:x,onInit:f,onUpdate:_}};class jo{constructor(){const e=c.realmModel.scene.getObjectByName("campfire");e.material=new ps({map:c.campfireDiffuse});const t=new Vo({preset:"fire",count:512,speed:.65,radius:.75});t.position.copy(e.position).setY(.25),A.scene.add(e,t);const s=K.fixed().setTranslation(...e.position.toArray()).setRotation(e.quaternion).setUserData({type:U.Stone}),o=v.world.createRigidBody(s);e.geometry.computeBoundingSphere();const{radius:a}=e.geometry.boundingSphere,n=J.ball(a).setRestitution(.75);v.world.createCollider(n,o)}}class qo extends W{constructor(){super(),this.precision="lowp",this.flatShading=!1,this.map=c.trunkDiffuse,this.normalMap=c.trunkNormal}}class Yo extends W{constructor(){super(),this.precision="lowp",this.flatShading=!1,this.map=c.axeDiffuse,this.emissiveMap=c.axeEmissive,this.emissiveIntensity=2,this.emissive=new Q("lightblue")}}class Ko{constructor(){const e=c.realmModel.scene.getObjectByName("kratos_axe");e.material=new Yo;const t=c.realmModel.scene.getObjectByName("tree_trunk");t.material=new qo,A.scene.add(e,t);const s=c.realmModel.scene.getObjectByName("axe_collider"),o=K.fixed().setTranslation(...s.position.toArray()).setRotation(s.quaternion).setUserData({type:U.Wood}),a=v.world.createRigidBody(o),n=s.geometry.boundingBox.max,i=J.cuboid(n.x,n.y,n.z).setRestitution(.75);v.world.createCollider(i,a);const r=c.realmModel.scene.getObjectByName("trunk_collider"),{x:d,y:u}=r.geometry.boundingBox.max,m=K.fixed().setTranslation(...r.position.toArray()).setRotation(r.quaternion).setUserData({type:U.Wood}),w=v.world.createRigidBody(m),f=d,_=u/2,x=J.capsule(_,f).setRestitution(.75);v.world.createCollider(x,w)}}class Jo{constructor(){const e=c.realmModel.scene.getObjectByName("jojo_mask");e.material=new Xo;const t=c.realmModel.scene.children.filter(a=>a.name.startsWith("jojo_symbol")),s=new $o,o=new oe(t[0].geometry,s,t.length);for(let a=0;a<t.length;a++){const n=t[a];o.setMatrixAt(a,n.matrix)}A.scene.add(e,o)}}class Xo extends W{constructor(){super(),this.precision="lowp",this.flatShading=!0;const{stoneDiffuse:e}=c.atlasesCoords.stones,t=Z.computeAtlasUv(L(...e.scale),L(...e.offset),C()),s=S(c.stoneAtlas,t);this.colorNode=s}}class $o extends W{constructor(){super(),this.precision="lowp",this.flatShading=!0;const e=Ye("#eb5694"),t=Ye("#9642D3");this.colorNode=D(t,e,C().y.mul(.5)).mul(.45);const s=G.mul(20),o=Y(s.add(y)),a=I(0,o).mul(.25);this.positionNode=ae.add(a)}}class Qo extends fs{uScale=h(1);constructor(){super();const e=S(c.kunaiDiffuse,C());this.colorNode=e.mul(5);const t=S(c.kunaiMR,C());this.metalnessNode=t.g,this.roughnessNode=t.b}}class ea{constructor(){const e=c.realmModel.scene.children.filter(({name:r})=>r.startsWith("kunai")),t=c.realmModel.scene.getObjectByName("base_kunai"),s=new Qo,o=new oe(t.geometry,s,e.length),{x:a,y:n,z:i}=t.geometry.boundingBox.max;e.forEach((r,d)=>{o.setMatrixAt(d,r.matrix);const u=K.fixed().setTranslation(...r.position.toArray()).setRotation(r.quaternion).setUserData({type:U.Wood}),m=v.world.createRigidBody(u),w=J.cuboid(a,n,i).setRestitution(.75);v.world.createCollider(w,m)}),A.scene.add(o)}}class ta extends W{constructor(){super(),this.map=c.onePieceAtlas,this.side=Re}}class sa{constructor(){const e=c.realmModel.scene.getObjectByName("one_piece_posters");e.material=new ta,A.scene.add(e)}}class oa{constructor(){new Ko,new sa,new Jo,new ea,new jo}}const mt={uBaseColor:h(new Q),uRandom:h(0)};class aa extends W{_uniforms;constructor(e){super(),this._uniforms={...mt,...e},this.createMaterial()}setRandomSeed(e){this._uniforms.uRandom.value=e}createMaterial(){this.precision="lowp",this.flatShading=!1;const e=k(C().mul(2).add(this._uniforms.uRandom)),{stoneDiffuse:t,stoneNormalAo:s}=c.atlasesCoords.stones,o=Z.computeAtlasUv(L(...t.scale),L(...t.offset),e),a=S(c.stoneAtlas,o);this.colorNode=a.mul(1.5);const n=Z.computeAtlasUv(L(...s.scale),L(...s.offset),e),i=S(c.stoneAtlas,n);this.normalNode=new Se(i.rgb,p(.5)),this.aoNode=i.a}}class na{uniforms=mt;constructor(){const e=new aa(this.uniforms),t=c.realmModel.scene.children.filter(({name:o})=>o.endsWith("_monument"));t.forEach((o,a)=>{const n=Ne.seededRandom(a);o.material=e,o.receiveShadow=!0,o.onBeforeRender=(i,r,d,u,m)=>{m.setRandomSeed(n)}}),A.scene.add(...t),c.realmModel.scene.children.filter(({name:o})=>o.startsWith("monument_collider")).forEach(o=>{const a=K.fixed().setTranslation(...o.position.toArray()).setRotation(o.quaternion).setUserData({type:U.Stone}),n=v.world.createRigidBody(a),i=.5*o.scale.x,r=.5*o.scale.y,d=.5*o.scale.z,u=J.cuboid(i,r,d).setRestitution(.75);v.world.createCollider(u,n)}),this.debugMonuments()}debugMonuments(){const e=te.panel.addFolder({title:"\uD83D\uDDFD Monuments"});e.expanded=!1,e.addBinding(this.uniforms.uBaseColor,"value",{label:"Base color",view:"color",color:{type:"float"}})}}class ia{constructor(){const e=c.realmModel.scene.getObjectByName("water"),t=new ra;e.material=t,A.scene.add(e),R.on("update",s=>{ut(e)&&t.update(s)}),R.on("audio-ready",()=>{e.add(j.lake)})}}class ra extends ot{playerDir=new le(0,0);uSpeed=h(.0025);uScale1=h(.25);uScale2=h(5);uWaveFrequency=h(2);uWaveAmplitude=h(.1);uFresnelScale=h(.4);uMinDist=h(15);uMaxDist=h(55);uBaseColor=h(new Q().setRGB(.06,.11,.1));uPlayerPosition=h(new E(0,0,0));uPlayerDirection=h(new le(0,0));uRippleStrength=h(.2);uMaxYDiff=h(1);uMaxDistSq=h(9);uRings=h(3);uAmplitude=h(.5);uRipplesScale=h(.3);constructor(){super(),this.createMaterial(),this.debugWater()}debugWater(){const e=te.panel.addFolder({title:"\uD83C\uDF0A Water",expanded:!1});e.addBinding(this.uSpeed,"value",{label:"Speed"}),e.addBinding(this.uScale1,"value",{label:"UV Scale 1"}),e.addBinding(this.uScale2,"value",{label:"UV Scale 2"}),e.addBinding(this.uWaveFrequency,"value",{label:"Wave frequency"}),e.addBinding(this.uWaveAmplitude,"value",{label:"Wave amplitude"}),e.addBinding(this.uFresnelScale,"value",{label:"Fresnel strength"}),e.addBinding(this.uMinDist,"value",{label:"Opacity min dist"}),e.addBinding(this.uMaxDist,"value",{label:"Opacity max dist"}),e.addBinding(this.uBaseColor,"value",{label:"Base color",view:"color",color:{type:"float"}}),e.addBinding(this.uRippleStrength,"value",{min:0,max:10,label:"Ripple strength"}),e.addBinding(this.uMaxYDiff,"value",{min:-10,max:10,label:"Y Max diff"}),e.addBinding(this.uMaxDistSq,"value",{min:0,max:50,label:"Max dist"}),e.addBinding(this.uRings,"value",{min:0,max:10,label:"# Rings"}),e.addBinding(this.uAmplitude,"value",{min:0,max:10,label:"Amplitude ripples"}),e.addBinding(this.uRipplesScale,"value",{min:0,max:3,label:"Ripples scale"})}update(e){const{player:t}=e,s=t.position.x-this.uPlayerPosition.value.x,o=t.position.z-this.uPlayerPosition.value.z;this.playerDir.set(s,o),this.uPlayerDirection.value.lerp(this.playerDir,.5).normalize(),this.uPlayerPosition.value.copy(t.position)}computeRipples=b(()=>{const e=O.xz,t=this.uPlayerPosition.xz,s=fe(this.uPlayerDirection),o=this.uPlayerPosition.y,a=e.sub(t),n=ye(a,a),i=I(n,this.uMaxDistSq),r=be(o.sub(O.y)),d=B(this.uMaxYDiff.add(.5),this.uMaxYDiff.negate().add(.5),r),u=this.uRings,m=G.sub(n.mul(.5)),w=Y(m.mul(u)).mul(ys(n.negate().mul(this.uAmplitude))),f=ye(fe(a),s).mul(.5).add(.5),_=B(.05,.95,f),x=w.mul(_).mul(this.uRippleStrength).mul(i).mul(d);return g(x)});tangentToObject=b(([e=g(0)])=>{const t=g(1,0,0),s=g(0,0,-1),o=g(0,1,0);return e.x.mul(t).add(e.y.mul(s)).add(e.z.mul(o))});objectToWorld=b(([e=g(0)])=>fe(gs.mul(e)));sampleTangentNormal=b(([e=L(0)])=>{const t=S(c.waterNormal,e);return g(t.r.mul(2).sub(1),t.g.mul(2).sub(1),t.b.mul(2).sub(1))});computeNormal=b(()=>{const t=this.computeRipples().xz.mul(this.uRipplesScale),s=G.mul(this.uSpeed).add(t),o=k(C().mul(this.uScale1).add(s)),a=this.sampleTangentNormal(o),n=k(C().mul(this.uScale2).sub(s)),i=this.sampleTangentNormal(n),r=k(C().mul(this.uScale2.mul(this.uScale1)).add(s)),d=this.sampleTangentNormal(r),u=D(a,i,.5),m=D(u,d,.5),w=this.tangentToObject(m);return this.objectToWorld(w)});computeFresnelFactor=b(([e=g(0),t=g(0)])=>{const s=ws(bs(p(1).sub(at(ye(t,e),0,1))));return this.uFresnelScale.mul(s)});computeReflectionColor=b(([e=g(0),t=g(0)])=>{const s=As(t,e);return xs(c.envMapTexture,s)});computeColorOpacity=b(()=>{const e=ye(O.xz.sub(De.xz),O.xz.sub(De.xz)),t=this.uMinDist,s=this.uMaxDist;return D(.05,.5,B(t.mul(t),s.mul(s),e))});computeColor=b(()=>{const e=this.computeNormal(),t=fe(De.sub(O)),s=this.computeReflectionColor(e,t),o=this.computeFresnelFactor(e,t),a=D(this.uBaseColor.rgb,s.rgb,o),n=this.computeColorOpacity();return V(a.rgb,n)});computePosition=b(()=>{const e=N(ae.xz).add(nt).mul(.015),t=Y(G.mul(e).mul(this.uWaveFrequency)).mul(this.uWaveAmplitude);return ae.add(g(0,t,0))});createMaterial(){this.precision="lowp",this.transparent=!0,this.positionNode=this.computePosition(),this.colorNode=this.computeColor()}}const Qe=20;class la extends W{_noiseBuffer;constructor(){super(),this._noiseBuffer=se(Qe,"float"),this._noiseBuffer.setPBO(!0),q.renderer.computeAsync(this.computeInit),this.precision="lowp",this.flatShading=!1;const e=N(y),t=this._noiseBuffer.element(y),s=I(.5,t),o=p(1).sub(s),a=k(C().mul(3.6).add(e)),n=k(C().mul(1.5).add(e)),i=a.mul(s).add(n.mul(o)),{stoneDiffuse:r,stoneNormalAo:d,stoneMossyDiffuse:u,stoneMossyNormalAo:m}=c.atlasesCoords.stones,w=L(...r.scale).mul(s),f=L(...u.scale).mul(o),_=w.add(f),x=L(...r.offset).mul(s),z=L(...u.offset).mul(o),F=x.add(z),ne=Z.computeAtlasUv(_,F,i);this.colorNode=S(c.stoneAtlas,ne);const X=L(...d.scale).mul(s),ce=L(...m.scale).mul(o),_e=X.add(ce),Le=L(...d.offset).mul(s),Me=L(...m.offset).mul(o),Fe=Le.add(Me),Ie=Z.computeAtlasUv(_e,Fe,i),de=S(c.stoneAtlas,Ie);this.normalNode=new Se(de.rgb,p(3)),this.aoNode=de.a}computeInit=b(()=>{const e=this._noiseBuffer.element(y),t=L(N(y),N(y).mul(21.63)).fract(),s=S(c.noiseTexture,t);e.assign(s.r)})().compute(Qe)}class ca{constructor(){const e=c.realmModel.scene.getObjectByName("stone"),t=c.realmModel.scene.children.filter(({name:a})=>a.startsWith("stone_collider")),s=new la,o=new oe(e.geometry,s,t.length);o.receiveShadow=!0,t.forEach((a,n)=>{o.setMatrixAt(n,a.matrix);const i=K.fixed().setTranslation(...a.position.toArray()).setRotation(a.quaternion).setUserData({type:U.Stone}),r=v.world.createRigidBody(i);a.geometry.computeBoundingBox();const d=a.geometry.boundingBox.max.x*a.scale.x,u=J.ball(d).setRestitution(.75);v.world.createCollider(u,r)}),A.scene.add(o)}}const da={uGrassTerrainColor:h(new Q().setRGB(.28,.24,0)),uWaterSandColor:h(new Q().setRGB(.54,.39,.2)),uPathSandColor:h(new Q().setRGB(.65,.49,.27))};class ua extends W{_uniforms={...da};constructor(){super(),this.createMaterial(),this.debugTerrain()}debugTerrain(){const e=te.panel.addFolder({title:"⛰️ Terrain"});e.expanded=!1,e.addBinding(this._uniforms.uPathSandColor,"value",{label:"Path color",view:"color",color:{type:"float"}}),e.addBinding(this._uniforms.uWaterSandColor,"value",{label:"Water bed color",view:"color",color:{type:"float"}}),e.addBinding(this._uniforms.uGrassTerrainColor,"value",{label:"Grass terrain color",view:"color",color:{type:"float"}})}computeCausticsDiffuse=b(([e=L(0,0),t=p(0),s=g(0,0,0)])=>{const o=G.mul(.15),a=e.mul(17),n=k(a.add(L(o,0))),i=S(c.noiseTexture,n,1).g,r=e.mul(33),d=k(r.add(L(0,o.negate()))),u=S(c.noiseTexture,d,3).g,m=i.add(u),w=B(-1,7.5,t),f=Ss(m,3).mul(p(1).sub(w)),_=g(.6,.8,1).mul(.5);return D(s,_,f)});computeWaterDiffuse=b(([e=p(0),t=L(0,0)])=>{const s=p(8),o=p(.001),a=B(0,s.add(o),e),n=this._uniforms.uWaterSandColor,i=g(.35,.45,.55).mul(.65),r=this.computeCausticsDiffuse(t,e),d=B(0,1.5,e),u=g(1,.9,.7).mul(.1).mul(d);return D(n,i,a).add(u).add(r)});createMaterial(){this.precision="lowp",this.flatShading=!1;const e=Z.computeMapUvByPosition(O.xz),t=Be(e),s=S(c.terrainShadowAo,C().clamp());this.aoNode=s.g;const o=S(c.terrainTypeMap,t,2.5),a=o.g,n=o.b,r=p(1).sub(a).sub(n),d=S(c.sandNormal,k(t.mul(30))),u=k(t.mul(30)),w=S(c.grassNormal,u).dot(d).mul(.65),f=S(c.grassDiffuse,u),_=p(1).sub(f.a),x=this._uniforms.uGrassTerrainColor.mul(_).add(f).mul(a).mul(.85),z=this._uniforms.uPathSandColor.mul(1.2).mul(r),F=Be(O.y.negate()),X=this.computeWaterDiffuse(F,t).mul(n),ce=x.add(z.mul(w)).add(X.mul(w).mul(.5));this.colorNode=ce.mul(s.r)}}class ma{constructor(e){const t=this.createFloor();t.material=e,A.scene.add(t)}createFloor(){const e=c.realmModel.scene.getObjectByName("floor");return e.receiveShadow=!0,this.createFloorPhysics(),e}getFloorDisplacementData(){const e=c.realmModel.scene.getObjectByName("heightfield"),t=e.geometry.attributes._displacement.array[0],s=e.geometry.attributes.position;e.geometry.boundingBox||e.geometry.computeBoundingBox();const o=e.geometry.boundingBox,a=s.count,n=Math.sqrt(a),i=o.max.x,r=new Float32Array(a);for(let d=0;d<a;d++){const u=s.array[d*3+0],m=s.array[d*3+1],w=s.array[d*3+2],f=Math.round((u/(i*2)+.5)*(n-1)),x=Math.round((w/(i*2)+.5)*(n-1))+f*n;r[x]=m}return{rowsCount:n,heights:r,displacement:t}}createFloorPhysics(){const e=this.getFloorDisplacementData(),{rowsCount:t,heights:s,displacement:o}=e,a=K.fixed().setTranslation(0,-o,0).setUserData({type:U.Terrain}),n=v.world.createRigidBody(a),i=J.heightfield(t-1,t-1,s,{x:H.MAP_SIZE,y:1,z:H.MAP_SIZE},Bs.FIX_INTERNAL_EDGES).setFriction(1).setRestitution(.2);v.world.createCollider(i,n)}}class ha{outerFloor;kintoun;kintounPosition=new E;constructor(e){this.outerFloor=this.createOuterFloorVisual(),this.outerFloor.material=e,this.kintoun=this.createKintoun(),A.scene.add(this.outerFloor),R.on("update",this.update.bind(this))}createOuterFloorVisual(){const e=c.realmModel.scene.getObjectByName("outer_world");return e.receiveShadow=!0,e}createKintoun(){const e=K.kinematicPositionBased().setTranslation(0,-20,0).setUserData({type:U.Terrain}),t=v.world.createRigidBody(e),s=2,o=J.cuboid(s,H.HALF_FLOOR_THICKNESS,s).setFriction(1).setRestitution(.2);return v.world.createCollider(o,t),t}useKintoun(e){this.kintounPosition.copy(e).setY(-H.HALF_FLOOR_THICKNESS),this.kintoun.setTranslation(this.kintounPosition,!0)}update(e){const{player:t}=e,s=H.HALF_MAP_SIZE-Math.abs(t.position.x)<H.KINTOUN_ACTIVATION_THRESHOLD,o=H.HALF_MAP_SIZE-Math.abs(t.position.z)<H.KINTOUN_ACTIVATION_THRESHOLD;(s||o)&&this.useKintoun(t.position);const a=H.MAP_SIZE,n=Math.abs(t.position.x),i=Math.sign(t.position.x),r=Math.abs(t.position.z),d=Math.sign(t.position.z),u=n>a?n-a:0,m=r>a?r-a:0;this.outerFloor.position.set(u*i,0,m*d)}}class pa{constructor(){const e=new ua;new ma(e),new ha(e)}}const fa=()=>({BLADE_WIDTH:.075,BLADE_HEIGHT:1.45,BLADE_BOUNDING_SPHERE_RADIUS:1.45,TILE_SIZE:150,TILE_HALF_SIZE:150/2,BLADES_PER_SIDE:500,COUNT:500*500,SPACING:150/500}),P=fa(),ht={uPlayerPosition:h(new E(0,0,0)),uCameraMatrix:h(new me),uBladeMinScale:h(.5),uBladeMaxScale:h(1.25),uTrailGrowthRate:h(.004),uTrailMinScale:h(.25),uTrailRaius:h(.65),uTrailRaiusSquared:h(.65*.65),uGlowRadius:h(2),uGlowRadiusSquared:h(4),uGlowFadeIn:h(.05),uGlowFadeOut:h(.01),uGlowColor:h(new Q().setRGB(.55,.21,.05)),uBladeMaxBendAngle:h(Math.PI*.15),uWindStrength:h(.6),uBaseColor:h(new Q().setRGB(.07,.07,0)),uTipColor:h(new Q().setRGB(.4,.2,.09)),uDelta:h(new le(0,0))};class ya extends ot{_uniforms;_buffer1;_buffer2;_buffer3;constructor(e){super(),this._uniforms={...ht,...e},this._buffer1=se(P.COUNT,"vec4"),this._buffer1.setPBO(!0),this._buffer2=se(P.COUNT,"vec4"),this._buffer2.setPBO(!0),this._buffer3=se(P.COUNT,"float"),this._buffer3.setPBO(!0),this.computeUpdate.onInit(({renderer:t})=>{t.computeAsync(this.computeInit)}),this.createGrassMaterial()}computeInit=b(()=>{const e=this._buffer1.element(y),t=Ae(p(y).div(P.BLADES_PER_SIDE)),s=p(y).mod(P.BLADES_PER_SIDE),o=N(y.add(4321)),a=N(y.add(1234)),n=s.mul(P.SPACING).sub(P.TILE_HALF_SIZE).add(o.mul(P.SPACING*.5)),i=t.mul(P.SPACING).sub(P.TILE_HALF_SIZE).add(a.mul(P.SPACING*.5)),r=g(n,0,i).xz.add(P.TILE_HALF_SIZE).div(P.TILE_SIZE).abs(),d=S(c.noiseTexture,r),u=d.b.sub(.5).mul(17),m=d.b.sub(.5).mul(13);e.x=n.add(u),e.y=i.add(m);const w=d.b.sub(.5).mul(p(Math.PI*2));e.z=w;const f=this._buffer2.element(y),_=this._uniforms.uBladeMaxScale.sub(this._uniforms.uBladeMinScale),x=N(y.add(958.32)).mul(_).add(this._uniforms.uBladeMinScale);f.x=x,f.y=x})().compute(P.COUNT);computeVisibility=b(([e=g(0)])=>{const t=this._uniforms.uCameraMatrix.mul(V(e,1)),s=t.xyz.div(t.w),o=P.BLADE_BOUNDING_SPHERE_RADIUS,a=p(1);return I(a.negate().sub(o),s.x).mul(I(s.x,a.add(o))).mul(I(a.negate().sub(o),s.y)).mul(I(s.y,a.add(o))).mul(I(0,s.z)).mul(I(s.z,a))});computeBending=b(([e=V(0),t=g(0)])=>{const s=t.xz.add(G.mul(.25)).mul(.5).fract(),a=S(c.noiseTexture,s,2).r.mul(this._uniforms.uWindStrength);return e.w.add(a.sub(e.w).mul(.1))});computeAlpha=b(([e=g(0)])=>{const t=Z.computeMapUvByPosition(e.xz);return S(c.terrainTypeMap,t).g});computeTrailScale=b(([e=V(0),t=p(0)])=>{const s=e.x.add(this._uniforms.uTrailGrowthRate),o=p(1).sub(t),a=this._uniforms.uTrailMinScale.mul(t).add(s.mul(o));return Ls(a,e.y)});computeTrailGlow=b(([e=V(0),t=p(0),s=p(0),o=p(0)])=>{const a=B(this._uniforms.uGlowRadiusSquared,p(0),t),n=100,i=Ae(be(this._uniforms.uDelta.x).mul(n)),r=Ae(be(this._uniforms.uDelta.y).mul(n)),d=I(1,i.add(r)),u=a.mul(p(1).sub(s)).mul(o),m=Ms(d,e.w).mul(u),w=m.mul(this._uniforms.uGlowFadeIn),f=p(1).sub(m).mul(this._uniforms.uGlowFadeOut),_=p(1).sub(d).mul(this._uniforms.uGlowFadeOut).mul(e.w);return at(e.w.add(w).sub(f).sub(_),0,1)});computeShadow=b(([e=g(0)])=>{const t=Z.computeMapUvByPosition(e.xz),s=S(c.terrainShadowAo,t);return I(.65,s.r)});computeUpdate=b(()=>{const e=this._buffer1.element(y),t=this._buffer2.element(y),s=this._buffer3.element(y),o=xe(e.x.sub(this._uniforms.uDelta.x).add(P.TILE_HALF_SIZE),P.TILE_SIZE).sub(P.TILE_HALF_SIZE),a=xe(e.y.sub(this._uniforms.uDelta.y).add(P.TILE_HALF_SIZE),P.TILE_SIZE).sub(P.TILE_HALF_SIZE),n=g(o,0,a);e.x=o,e.y=a;const i=n.add(this._uniforms.uPlayerPosition),r=this.computeVisibility(i);t.z=r,rt(r,()=>{const d=L(this._uniforms.uDelta.x,this._uniforms.uDelta.y),u=n.xz.sub(d),m=u.dot(u),w=I(.1,p(1).sub(this._uniforms.uPlayerPosition.y)),f=I(m,this._uniforms.uTrailRaiusSquared).mul(w);t.x=this.computeTrailScale(t,f),t.z=this.computeAlpha(i),e.w=this.computeBending(e,i),t.w=this.computeTrailGlow(t,m,f,w);const _=this.computeShadow(i);s.assign(_)})})().compute(P.COUNT);computePosition=b(([e=V(0),t=V(0)])=>{const s=g(e.x,0,e.y),o=e.z,a=e.w,n=t.x,i=a.mul(C().y),d=Ke(ae,g(i,0,0)).mul(g(1,n,1)),u=Ke(d,g(0,o,0)),m=N(y).mul(6.28),w=Y(G.mul(5).add(e.w).add(m)).mul(.1),f=C().y.mul(t.w),_=w.mul(f);return u.add(s).add(g(_))});computeDiffuseColor=b(([e=V(0),t=p(1)])=>{const s=C().y,o=D(this._uniforms.uBaseColor,this._uniforms.uTipColor,s),a=N(y.add(1e3)).mul(.03).add(.985),n=o.mul(a).clamp(),i=e.w,r=D(n,this._uniforms.uGlowColor.mul(.5),i);return D(r.mul(.5),r,t)});computeAO=b(()=>{const e=C().x,t=C().y,s=N(y).mul(.5).sub(.05),o=B(0,1.2,be(e.add(s))),a=B(0,.6,t.negate()),n=B(.3,.6,t).mul(.1),i=a.add(o).add(n).mul(.75);return p(1).sub(i).mul(1.2)});createGrassMaterial(){this.precision="lowp",this.side=Re;const e=this._buffer1.element(y),t=this._buffer2.element(y),s=this._buffer3.element(y);Is(t.z.equal(0)),this.positionNode=this.computePosition(e,t),this.opacityNode=t.z,this.alphaTest=.5,this.aoNode=this.computeAO(),this.colorNode=this.computeDiffuseColor(t,s)}async updateAsync(){q.renderer.computeAsync(this.computeUpdate)}}class ga{material;grassField;uniforms={...ht,uDelta:h(new le(0,0)),uPlayerPosition:h(new E(0,0,0)),uCameraMatrix:h(new me)};constructor(){const e=this.createBladeGeometry();e.instanceCount=P.COUNT,this.material=new ya(this.uniforms),this.grassField=new it(e,this.material),A.scene.add(this.grassField),R.on("update",this.updateAsync.bind(this)),this.debugGrass()}debugGrass(){const e=te.panel.addFolder({title:"\uD83C\uDF31 Grass"});e.expanded=!1,e.addBinding(this.uniforms.uTipColor,"value",{label:"Tip Color",view:"color",color:{type:"float"}}),e.addBinding(this.uniforms.uBaseColor,"value",{label:"Base Color",view:"color",color:{type:"float"}}),e.addBinding(this.uniforms.uGlowColor,"value",{label:"Glow Color",view:"color",color:{type:"float"}}),e.addBinding(this.uniforms.uWindStrength,"value",{label:"Wind strength",min:0,max:Math.PI/2,step:.1})}createBladeGeometry(){const e=P.BLADE_WIDTH/2,t=e/2,s=P.BLADE_HEIGHT/4,o=new Float32Array([-e,0,0,e,0,0,-t*1.25,s*1,0,t*1.25,s*1,0,-t*.75,s*2,0,t*.75,s*2,0,0,s*3,0]),a=new Float32Array([0,0,1,0,.25,s*1,.75,s*1,.375,s*2,.625,s*2,.5,s*3]),n=new Uint16Array([0,1,3,0,3,2,2,3,5,2,5,4,4,5,6]),i=25*Math.PI/180,r=15*Math.PI/180,d=8*Math.PI/180,u=Math.cos(i),m=Math.sin(i),w=Math.cos(r),f=Math.sin(r),_=Math.cos(d),x=Math.sin(d),z=new Float32Array([-u,m,0,u,m,0,-w,f,0,w,f,0,-_,x,0,_,x,0,0,1,0]),F=new _s;return F.setAttribute("position",new ge(o,3)),F.setAttribute("uv",new ge(a,2)),F.setIndex(new ge(n,1)),F.setAttribute("normal",new ge(z,3)),F}async updateAsync(e){const{player:t}=e,s=t.position.x-this.grassField.position.x,o=t.position.z-this.grassField.position.z;this.uniforms.uDelta.value.set(s,o),this.uniforms.uPlayerPosition.value.copy(t.position),this.uniforms.uCameraMatrix.value.copy(A.playerCamera.projectionMatrix).multiply(A.playerCamera.matrixWorldInverse),this.grassField.position.copy(t.position).setY(0),this.material.updateAsync()}}const wa=()=>({FLOWER_WIDTH:.5,FLOWER_HEIGHT:1,BLADE_BOUNDING_SPHERE_RADIUS:1,TILE_SIZE:150,TILE_HALF_SIZE:150/2,FLOWERS_PER_SIDE:25,COUNT:25*25,SPACING:150/25}),T=wa();class ba{flowerField;material;uniforms={...pt,uDelta:h(new le(0,0)),uPlayerPosition:h(new E(0,0,0)),uCameraMatrix:h(new me)};constructor(){this.material=new Aa(this.uniforms),this.flowerField=new oe(new et(1,1),this.material,T.COUNT),A.scene.add(this.flowerField),R.on("update",this.updateAsync.bind(this))}async updateAsync(e){const{player:t}=e,s=t.position.x-this.flowerField.position.x,o=t.position.z-this.flowerField.position.z;this.uniforms.uDelta.value.set(s,o),this.uniforms.uPlayerPosition.value.copy(t.position),this.uniforms.uCameraMatrix.value.copy(A.playerCamera.projectionMatrix).multiply(A.playerCamera.matrixWorldInverse),this.flowerField.position.copy(t.position).setY(0),this.material.updateAsync()}}const pt={uPlayerPosition:h(new E(0,0,0)),uCameraMatrix:h(new me),uDelta:h(new le(0,0))};class Aa extends st{_uniforms;_buffer1;constructor(e){super(),this._uniforms={...pt,...e},this._buffer1=se(T.COUNT,"vec4"),this._buffer1.setPBO(!0),this.computeUpdate.onInit(({renderer:t})=>{t.computeAsync(this.computeInit)}),this.createMaterial()}computeInit=b(()=>{const e=this._buffer1.element(y),t=Ae(p(y).div(T.FLOWERS_PER_SIDE)),s=p(y).mod(T.FLOWERS_PER_SIDE),o=N(y.add(4321)),a=N(y.add(1234)),n=s.mul(T.SPACING).sub(T.TILE_HALF_SIZE).add(o.mul(T.SPACING*.5)),i=t.mul(T.SPACING).sub(T.TILE_HALF_SIZE).add(a.mul(T.SPACING*.5)),r=g(n,0,i).xz.add(T.TILE_HALF_SIZE).div(T.TILE_SIZE).abs(),u=S(c.noiseTexture,r).r,m=u.sub(.5).mul(100),w=u.clamp(.5,.75),f=u.sub(.5).mul(50);e.x=n.add(m),e.y=w,e.z=i.add(f)})().compute(T.COUNT);computeVisibility=b(([e=g(0)])=>{const t=this._uniforms.uCameraMatrix.mul(V(e,1)),s=t.xyz.div(t.w),o=T.BLADE_BOUNDING_SPHERE_RADIUS,a=p(1);return I(a.negate().sub(o),s.x).mul(I(s.x,a.add(o))).mul(I(a.negate().sub(o),s.y)).mul(I(s.y,a.add(o))).mul(I(0,s.z)).mul(I(s.z,a))});computeAlpha=b(([e=g(0)])=>{const t=Z.computeMapUvByPosition(e.xz);return S(c.terrainTypeMap,t).g});computeUpdate=b(()=>{const e=this._buffer1.element(y),t=xe(e.x.sub(this._uniforms.uDelta.x).add(T.TILE_HALF_SIZE),T.TILE_SIZE).sub(T.TILE_HALF_SIZE),s=xe(e.z.sub(this._uniforms.uDelta.y).add(T.TILE_HALF_SIZE),T.TILE_SIZE).sub(T.TILE_HALF_SIZE);e.x=t,e.z=s;const a=g(e.x,0,e.z).add(this._uniforms.uPlayerPosition),n=this.computeVisibility(a);e.w=n,rt(n,()=>{e.w=this.computeAlpha(a)})})().compute(T.COUNT);createMaterial(){this.precision="lowp";const e=this._buffer1.element(y),t=N(y.add(9234)),s=N(y.add(33.87)),o=G.mul(2),a=Y(o.add(t.mul(100))).mul(.05);this.positionNode=e.xyz.add(g(a,0,a)),this.opacityNode=e.w,this.alphaTest=.15,this.scaleNode=t.mul(.2).add(.3);const n=I(.5,t).mul(.5),i=I(.5,s).mul(.5),d=C().mul(.5).add(L(n,i)),u=S(c.flowerAtlas,d);this.colorNode=V(u.rgb.mul(.5),u.a)}async updateAsync(){q.renderer.computeAsync(this.computeUpdate)}}class xa{constructor(){const e=c.realmModel.scene.getObjectByName("water_lilies");e.material=this.createMaterial(),A.scene.add(e)}createMaterial(){const e=new W;e.precision="lowp",e.transparent=!0,e.map=c.waterLiliesTexture,e.alphaTest=.5,e.alphaMap=c.waterLiliesAlphaTexture;const t=G.mul(5e-4),s=O.x.mul(.1),o=S(c.noiseTexture,k(O.xz.add(t).mul(s))).b.mul(.5),a=Y(o);return e.positionNode=ae.add(a),e}}class Sa extends W{constructor(){super(),this.precision="lowp",this.flatShading=!1;const e=k(C().mul(7)),t=S(c.barkDiffuse,e);this.colorNode=t;const s=S(c.barkNormal,e);this.normalNode=new Se(s)}}class _a extends W{constructor(){super(),this.precision="lowp",this.flatShading=!1,this.transparent=!0,this.side=Re;const e=Z.computeMapUvByPosition(O.xz),t=S(c.noiseTexture,e),s=S(c.canopyDiffuse,C()),o=D(g(.889,.095,0),g(1,.162,.009),.5);this.colorNode=D(s.mul(1.25),o,t.b.mul(.4));const a=S(c.canopyNormal,C());this.normalNode=new Se(a,p(1.25)),this.alphaTest=.9;const n=G.mul(t.r).add(nt).mul(7.5),i=Y(n).mul(.015),r=tt(n.mul(.75)).mul(.01);this.positionNode=ae.add(g(0,r,i))}}class La{constructor(){const e=c.realmModel.scene.getObjectByName("tree"),t=c.realmModel.scene.children.filter(({name:f})=>f.startsWith("tree_collider")),s=new Sa,o=new _a,[a,n]=e.children,i=new oe(a.geometry,s,t.length);i.receiveShadow=!0;const r=new oe(n.geometry,o,t.length),u=c.realmModel.scene.getObjectByName("base_tree_collider").geometry.boundingBox,m=u.max.x,w=u.max.y/2;t.forEach((f,_)=>{i.setMatrixAt(_,f.matrix),r.setMatrixAt(_,f.matrix);const x=K.fixed().setTranslation(...f.position.toArray()).setRotation(f.quaternion).setUserData({type:U.Wood}),z=v.world.createRigidBody(x),F=m*f.scale.x,ne=w*f.scale.y,X=J.capsule(ne,F).setRestitution(.75);v.world.createCollider(X,z)}),A.scene.add(i,r)}}class Ma{constructor(){new ga,new xa,new ba,new La}}const Ia="/revo-realms/textures/hud/compass.webp",Pa="/revo-realms/textures/hud/compassArrow.webp";class va{constructor(){const e=document.createElement("div");e.classList.add("compass-container");const t=document.createElement("img");t.setAttribute("alt","compass"),t.setAttribute("src",Ia),t.classList.add("compass"),e.appendChild(t);const s=document.createElement("img");s.setAttribute("alt","arrow"),s.setAttribute("src",Pa),s.classList.add("compass-arrow"),e.appendChild(s),document.body.appendChild(e);const o=H.MAP_SIZE/2;let a=0;R.on("update-throttle-16x",({player:n})=>{const i=Math.abs(n.position.x)>o,r=Math.abs(n.position.z)>o,u=i||r?.65:0;if(e.style.setProperty("--opacity",`${u}`),!u)return;const m=Math.atan2(-n.position.x,-n.position.z);a=this.unwrapAngle(a,m-n.yaw),s.style.setProperty("--yaw",`${-a}rad`)})}unwrapAngle(e,t){const s=t-e;return e+((s+Math.PI)%(2*Math.PI)-Math.PI)}}const Ea=()=>Object.freeze({MAP_SIZE:256,HALF_MAP_SIZE:256/2,KINTOUN_ACTIVATION_THRESHOLD:2,HALF_FLOOR_THICKNESS:.3,OUTER_MAP_SIZE:256*3,OUTER_HALF_MAP_SIZE:256*1.5}),H=Ea();class Ta{constructor(){new va,new pa,new na,new ia,new Ma,new ca,new oa}}class Da{computeMapUvByPosition=b(([e=L(0)])=>e.add(H.HALF_MAP_SIZE).div(H.MAP_SIZE));computeAtlasUv=b(([e=L(0),t=L(0),s=L(0)])=>s.mul(e).add(t))}const Z=new Da,Ca=()=>({JUMP_BUFFER_DURATION_IN_SECONDS:.2,MAX_CONSECUTIVE_JUMPS:2,JUMP_CUT_MULTIPLIER:.25,FALL_MULTIPLIER:2.75,MAX_UPWARD_VELOCITY:6,LINEAR_DAMPING:.35,ANGULAR_DAMPING:.6,JUMP_IMPULSE:new E(0,75,0),LIN_VEL_STRENGTH:35,ANG_VEL_STRENGTH:25,RADIUS:.5,MASS:3,PLAYER_INITIAL_POSITION:new E(0,5,0),CAMERA_OFFSET:new E(0,11,17),CAMERA_LERP_FACTOR:7.5,UP:new E(0,1,0),DOWN:new E(0,-1,0),FORWARD:new E(0,0,-1)}),M=Ca();class Na{mesh;rigidBody;smoothedCameraPosition=new E;desiredCameraPosition=new E;smoothedCameraTarget=new E;desiredTargetPosition=new E;yawInRadians=0;prevYawInRadians=-1;yawQuaternion=new Ps;newLinVel=new E;newAngVel=new E;torqueAxis=new E;forwardVec=new E;isOnGround=!1;jumpCount=0;wasJumpHeld=!1;jumpBufferTimer=0;rayOrigin=new E;ray=new Rs(this.rayOrigin,M.DOWN);constructor(){this.mesh=this.createCharacterMesh(),A.scene.add(this.mesh),ct.setTarget(this.mesh),this.rigidBody=v.world.createRigidBody(this.createRigidBodyDesc()),v.world.createCollider(this.createColliderDesc(),this.rigidBody),R.on("update",this.update.bind(this)),R.on("update-throttle-64x",this.resetPlayerPosition.bind(this)),this.debugPlayer()}resetPlayerPosition(e){const{player:t}=e;t.position.y>-10||(this.rigidBody.setLinvel({x:0,y:0,z:0},!1),this.rigidBody.setAngvel({x:0,y:0,z:0},!1),this.rigidBody.setTranslation(M.PLAYER_INITIAL_POSITION,!0),this.mesh.position.copy(M.PLAYER_INITIAL_POSITION))}debugPlayer(){const e=te.panel.addFolder({title:"\uD83E\uDEA9 Player",expanded:!1});e.addBinding(M.CAMERA_OFFSET,"y",{label:"Main camera height"}),e.addBinding(M.CAMERA_OFFSET,"z",{label:"Main camera distance"})}createCharacterMesh(){const e=new vs(M.RADIUS,2),t=new Ba,s=new it(e,t);return s.castShadow=!0,s.position.copy(M.PLAYER_INITIAL_POSITION),s}createRigidBodyDesc(){const{x:e,y:t,z:s}=M.PLAYER_INITIAL_POSITION;return K.dynamic().setTranslation(e,t,s).setLinearDamping(M.LINEAR_DAMPING).setAngularDamping(M.ANGULAR_DAMPING).setUserData({type:U.Player})}createColliderDesc(){return J.ball(M.RADIUS).setRestitution(.25).setFriction(1).setMass(M.MASS).setActiveEvents(Fs.COLLISION_EVENTS)}update(e){const{clock:t}=e,s=t.getDelta();this.prevYawInRadians!==this.yawInRadians&&(this.yawQuaternion.setFromAxisAngle(M.UP,this.yawInRadians),this.prevYawInRadians=this.yawInRadians),this.updateVerticalMovement(s),this.updateHorizontalMovement(s),this.updateCameraPosition(s)}updateVerticalMovement(e){const t=ue.isJumpPressed();this.isOnGround=this.checkIfGrounded(),this.isOnGround&&(this.jumpCount=0),t&&!this.wasJumpHeld?this.jumpBufferTimer=M.JUMP_BUFFER_DURATION_IN_SECONDS:this.jumpBufferTimer=Math.max(0,this.jumpBufferTimer-e),this.jumpBufferTimer>0&&this.canJump()&&(this.performJump(),this.jumpBufferTimer=0);const o=this.rigidBody.linvel();this.handleJumpCut(t,o),this.handleFastFall(e,o,v.world.gravity.y),this.clampUpwardVelocity(o),this.rigidBody.setLinvel(o,!0),this.wasJumpHeld=t}checkIfGrounded(){this.rayOrigin.copy(this.rigidBody.translation()),this.rayOrigin.y-=M.RADIUS+.01;const e=.2,t=v.world.castRay(this.ray,e,!0);return t?t.timeOfImpact*e<.01:!1}canJump(){return this.isOnGround?!0:this.jumpCount<M.MAX_CONSECUTIVE_JUMPS}performJump(){this.rigidBody.applyImpulse(M.JUMP_IMPULSE,!0),this.jumpCount+=1}handleJumpCut(e,t){!(!e&&this.wasJumpHeld)||t.y<=0||(t.y*=M.JUMP_CUT_MULTIPLIER)}handleFastFall(e,t,s){if(t.y>=0)return;const o=M.FALL_MULTIPLIER*Math.abs(s)*e;t.y-=o}clampUpwardVelocity(e){e.y<=M.MAX_UPWARD_VELOCITY||(e.y=M.MAX_UPWARD_VELOCITY)}updateHorizontalMovement(e){const t=ue.isForward(),s=ue.isBackward(),o=ue.isLeftward(),a=ue.isRightward(),n=2;o&&(this.yawInRadians+=n*e),a&&(this.yawInRadians-=n*e),this.forwardVec.copy(M.FORWARD).applyQuaternion(this.yawQuaternion),this.torqueAxis.crossVectors(M.UP,this.forwardVec).normalize(),this.newLinVel.copy(this.rigidBody.linvel()),this.newAngVel.copy(this.rigidBody.angvel());const i=M.LIN_VEL_STRENGTH*e,r=M.ANG_VEL_STRENGTH*e;t&&(this.newLinVel.addScaledVector(this.forwardVec,i),this.newAngVel.addScaledVector(this.torqueAxis,r)),s&&(this.newLinVel.addScaledVector(this.forwardVec,-i),this.newAngVel.addScaledVector(this.torqueAxis,-r)),this.rigidBody.setLinvel(this.newLinVel,!0),this.rigidBody.setAngvel(this.newAngVel,!0),this.syncMeshWithBody()}syncMeshWithBody(){this.mesh.position.copy(this.rigidBody.translation()),this.mesh.quaternion.copy(this.rigidBody.rotation())}updateCameraPosition(e){this.desiredCameraPosition.copy(M.CAMERA_OFFSET).applyQuaternion(this.yawQuaternion).add(this.mesh.position);const t=M.CAMERA_LERP_FACTOR*e;this.smoothedCameraPosition.lerp(this.desiredCameraPosition,t),this.desiredTargetPosition.copy(this.mesh.position),this.desiredTargetPosition.y+=1,this.smoothedCameraTarget.lerp(this.desiredTargetPosition,t),A.playerCamera.position.copy(this.smoothedCameraPosition),A.playerCamera.lookAt(this.smoothedCameraTarget)}get position(){return this.mesh.position}get yaw(){return this.yawInRadians}}class Ba extends W{constructor(){super(),this.createMaterial()}createMaterial(){this.flatShading=!0,this.castShadowNode=g(.6);const e=Z.computeMapUvByPosition(O.xz),t=Be(e),s=ct.getTerrainShadowFactor(t),o=S(c.noiseTexture,k(O.xz),3).r,a=Y(G.mul(2.5).add(o.mul(5))).mul(.05),n=p(-.45).add(a),i=p(1).sub(I(n,O.y)),r=p(1).sub(i),d=g(1),u=p(1).sub(B(-1.5,1,O.y).mul(i)),m=D(g(1),g(.6,.8,1).mul(.75),u),w=d.mul(m).mul(i),_=d.mul(r).add(w);this.colorNode=_.mul(s)}}class Ra{player;constructor(){this.player=new Na,new Ta}getSizes(){const e=window.innerWidth,t=window.innerHeight;return{width:e,height:t,dpr:Math.min(window.devicePixelRatio,1.5),aspect:e/t}}onResize(){const e=this.getSizes();A.playerCamera.aspect=e.aspect,A.playerCamera.updateProjectionMatrix(),q.renderer.setSize(e.width,e.height),q.renderer.setPixelRatio(e.dpr)}async startLoop(){await q.init();const t={clock:new Es(!0),player:this.player},s=async()=>{v.update(),R.emit("update",t),q.renderAsync()};new ResizeObserver(()=>{this.onResize()}).observe(document.body),q.renderer.setAnimationLoop(s)}}class Fa{constructor(){}init(){this.initAudioButton(),this.initCreditsButton()}initAudioButton(){const e=document.getElementById("audio");e.disabled=!0;const t=e?.querySelector("path");if(!e||!t)return;const s="M1129.432 113v1694.148H903.545l-451.772-451.773V564.773L903.545 113h225.887Zm542.545 248.057C1832.017 521.097 1920 733.882 1920 960.107c0 226.226-87.983 438.898-248.023 598.938l-79.851-79.85c138.694-138.582 214.93-323.018 214.93-519.087 0-196.183-76.236-380.506-214.93-519.2ZM338.83 564.773v790.602H169.415C75.672 1355.375 0 1279.703 0 1185.96V734.187c0-93.742 75.672-169.414 169.415-169.414H338.83Zm1093.922 36.085c95.776 97.018 148.407 224.644 148.407 359.16 0 134.628-52.631 262.253-148.407 359.272l-80.303-79.174c74.656-75.897 115.767-175.4 115.767-280.099 0-104.585-41.111-204.088-115.767-279.986Z",o="M1129.433 113v1694.15H903.547l-451.774-451.773V564.773L903.547 113h225.886ZM338.83 564.773v790.604H169.415c-92.806 0-167.9-74.166-169.392-166.609L0 1185.962V734.188c0-92.805 74.166-167.9 166.608-169.392l2.807-.023H338.83ZM1789.951 635 1920 764.926 1724.988 959.94 1920 1154.95 1789.951 1285l-194.89-195.012L1400.05 1285 1270 1154.951l195.012-195.012L1270 764.926 1400.049 635l195.012 195.012L1789.951 635Z";e.addEventListener("click",async a=>{a.stopPropagation(),await j.toggleMute();const n=j.isMute?o:s;t.setAttribute("d",n)}),R.on("audio-ready",()=>{e.disabled=!1})}initCreditsButton(){const e=document.getElementById("credits"),t=document.getElementById("credits-dialog");if(!e||!t)return;t.addEventListener("click",r=>{switch(r.stopPropagation(),r.target?.id){case"credits-dialog":case"close-dialog-btn":t.close();break}}),e.addEventListener("click",r=>{r.stopPropagation(),t.showModal()});const a="aleksandar.d.gjoreski@gmail.com",n=document.createElement("a");n.setAttribute("href",`mailto:${a}`),n.innerText=a,document.getElementById("email-placeholder")?.appendChild(n)}}const Oa=new Fa,Ua=new Uo;Ua.initAsync().then(()=>{Oa.init(),new Ra().startLoop()})});